function Validation(){this.init=function(t){this.defaultParams={classItem:"valItem",attributeErrorMessage:"data-msg",attributeErrorClassMessage:"data-error-class-msg",attributeErrorClassInput:"data-error-class-input",attributeErrorBox:"data-box",attributePromptMessage:"data-prompt",attributePromptClassMessage:"data-prompt-class-msg",attributePromptBox:"data-prompt-box",attributeSuccessMessage:"data-success",attributeSuccessClassMessage:"data-success-class-msg",attributeSuccessClassInput:"data-success-class-input",attributeSuccessBox:"data-success-box",event:"submit",eventElement:"#submit",errorClass:"inputError",successClass:"inputSuccess",errorMessageClass:"errorMsgClass",successMessageClass:"successMsgClass",promptMessageClass:"promptClass",ajaxUrl:"ajax.php",ajax:!1,submitForm:!0,tpl:[],tpl_msg:[],errorMsgTpl:!1,promptMsgTpl:!1,successMsgTpl:!1,items:[],ajaxSubmitSuccess:function(t,s,e){s||e.submit()},submitSuccess:function(t,s){t||s.submit()},submitError:function(t,s){},ajaxOnblurSuccess:function(t,s,e){}},this.finalParams=this.defaultParams;for(var s in t)t.hasOwnProperty(s)&&void 0!==t[s]&&(this.finalParams[s]=t[s]);this.options=this.finalParams;for(var e=this.getValInput(),r=0;r<e.length;r++)e[r].onfocus=this.customPrompt.bind(this);if("submit"==this.options.event){this.getSubmitElement().onclick=this.customSubmit.bind(this);for(var i=0;i<e.length;i++)e[i].onblur=this.clearPrompt.bind(this)}else if("onblur"==this.options.event)for(var a=0;a<e.length;a++)e[a].onblur=this.customValidationOnblur.bind(this)},this.customSubmit=function(t){t.preventDefault();var s=document.getElementsByClassName(this.options.classItem),e=this.getParent(this.getSubmitElement(),"FORM"),r=[];this.clearMsgBox();for(var i=0;i<s.length;i++){var a=s[i].nextElementSibling;if(null!=a&&a.classList.contains(this.options.errorMessageClass)&&a.parentNode.removeChild(a),s[i].hasAttribute("data-tpl")||this.hasTpl(s[i])){var o=this.getTpl(s[i]),n=this.tpls(),l=(this.tpls_msg(),s[i].value);n[o.trim()].test(l)?(this.deleteErrorMsg(s[i]),this.generateMsg(s[i],"success"),r.push(!0)):(this.deleteErrorMsg(s[i]),this.generateMsg(s[i],"error",this.getTplMsg(s[i])),r.push(!1))}else s[i].checkValidity()?(this.deleteErrorMsg(s[i]),this.generateMsg(s[i],"success"),r.push(!0)):(this.deleteErrorMsg(s[i]),this.generateMsg(s[i],"error"),r.push(!1))}!1!==this.findFalse(r)?this.options.ajax?this.ajaxValidPost(s,this.options.ajaxSubmitSuccess):this.options.submitForm&&this.options.submitSuccess(!1,e):this.options.submitError(!0,e)},this.customValidationOnblur=function(t){var s=t.target,e=s.nextSibling;if(null!=e&&e.classList.contains(this.options.errorMessageClass)&&e.parentNode.removeChild(e),s.hasAttribute("data-tpl")||this.hasTpl(s)){var r=this.getTpl(s),i=this.tpls(),a=s.value;i[r.trim()].test(a)?this.options.ajax?this.ajaxValidPost(s,this.options.ajaxOnblurSuccess):(this.deleteErrorMsg(s),this.generateMsg(s,"success")):(this.deleteErrorMsg(s),this.generateMsg(s,"error",this.getTplMsg(s)))}else s.checkValidity()?this.options.ajax?this.ajaxValidPost(s,this.options.ajaxOnblurSuccess):(this.deleteErrorMsg(s),this.generateMsg(s,"success")):(this.deleteErrorMsg(s),this.generateMsg(s,"error"))},this.customPrompt=function(t){var s=t.target;this.hasMsg(s,"prompt")&&(this.deleteErrorMsg(s),this.generateMsg(s,"prompt"))},this.clearPrompt=function(t){var s=t.target;if(this.deleteErrorMsg(s),s.hasAttribute(this.options.attributePromptBox)){this.getElement(s.getAttribute(this.options.attributePromptBox)).innerHTML=""}},this.clearMsgBox=function(){for(var t=this.getValInput(),s=0;s<t.length;s++){t[s].hasAttribute(this.options.attributeErrorBox)&&(this.getElement(t[s].getAttribute(this.options.attributeErrorBox)).innerHTML=""),t[s].hasAttribute(this.options.attributePromptBox)&&(this.getElement(t[s].getAttribute(this.options.attributePromptBox)).innerHTML=""),t[s].hasAttribute(this.options.attributeSuccessBox)&&(this.getElement(t[s].getAttribute(this.options.attributeSuccessBox)).innerHTML="")}},this.getParent=function(t,s){return t.tagName==s?t:this.getParent(t.parentNode,s)},this.generateErrorMsg=function(t){var s=this.getInputErrorClass(t),e=this.getMsgErrorClass(t);if(t.classList.add(s),t.hasAttribute(this.options.attributeErrorMessage)){var r=document.createElement("span");if(r.classList.add(e),r.innerHTML=t.getAttribute(this.options.attributeErrorMessage),t.hasAttribute(this.options.attributeErrorBox)){var i=this.getElement(t.getAttribute(this.options.attributeErrorBox));r.classList.add("error-to-"+t.getAttribute("name")),i.appendChild(r)}else this.insertAfter(r,t)}},this.generateMsg=function(t,s,e){e=e||"";var r,i,a;if("error"==s&&(r=this.getInputErrorClass(t),i=this.getMsgErrorClass(t),t.classList.add(r),a=this.options.attributeErrorBox),"prompt"==s&&(i=this.getMsgPromptClass(t),a=this.options.attributePromptBox),"success"==s&&(r=this.getInputSuccessClass(t),i=this.getMsgSuccessClass(t),t.classList.add(r),a=this.options.attributeSuccessBox),this.hasMsg(t,s)||""!=e){var o,n=""!=e?e:this.getMsg(t,s);(o=this.generateTplMsg(t,s,n))&&(n=o);var l=document.createElement("span");if(l.classList.add(i),l.innerHTML=n,t.hasAttribute(a)){var u=this.getElement(t.getAttribute(a));l.classList.add(s+"-to-"+t.getAttribute("name")),u.appendChild(l)}else this.insertAfter(l,t)}},this.generateAjaxErrorMsg=function(t,s){t.classList.add(this.options.errorClass);var e=document.createElement("span");e.classList.add(this.options.errorMessageClass),e.innerHTML=s,this.insertAfter(e,t)},this.generateTplMsg=function(t,s,e){return"error"==s&&this.options.errorMsgTpl?this.options.errorMsgTpl.replace("{msg}",e):"prompt"==s&&this.options.promptMsgTpl?this.options.promptMsgTpl.replace("{msg}",e):!("success"!=s||!this.options.successMsgTpl)&&this.options.successMsgTpl.replace("{msg}",e)},this.getInputErrorClass=function(t){var s=this.getScriptItem(t);return void 0!==s.errorClass?s.errorClass:t.hasAttribute(this.options.attributeErrorClassInput)?t.getAttribute(this.options.attributeErrorClassInput):this.options.errorClass},this.getMsgErrorClass=function(t){var s=this.getScriptItem(t);return void 0!==s.errorMsgClass?s.errorMsgClass:t.hasAttribute(this.options.attributeErrorClassMessage)?t.getAttribute(this.options.attributeErrorClassMessage):this.options.errorMessageClass},this.getMsgPromptClass=function(t){var s=this.getScriptItem(t);return void 0!==s.promptMsgClass?s.promptMsgClass:t.hasAttribute(this.options.attributePromptClassMessage)?t.getAttribute(this.options.attributePromptClassMessage):this.options.promptMessageClass},this.getMsgSuccessClass=function(t){var s=this.getScriptItem(t);return void 0!==s.successMsgClass?s.successMsgClass:t.hasAttribute(this.options.attributeSuccessClassMessage)?t.getAttribute(this.options.attributeSuccessClassMessage):this.options.successMessageClass},this.getInputSuccessClass=function(t){var s=this.getScriptItem(t);return void 0!==s.successClass?s.successClass:t.hasAttribute(this.options.attributeSuccessClassInput)?t.getAttribute(this.options.attributeSuccessClassInput):this.options.successClass},this.getMsg=function(t,s){return this.hasScriptMsg(t,s)?this.getScriptMsg(t,s):"error"==s?t.getAttribute(this.options.attributeErrorMessage):"prompt"==s?t.getAttribute(this.options.attributePromptMessage):"success"==s?t.getAttribute(this.options.attributeSuccessMessage):void 0},this.hasMsg=function(t,s){var e;return!!this.hasScriptMsg(t,s)||("error"==s&&(e=this.options.attributeErrorMessage),"prompt"==s&&(e=this.options.attributePromptMessage),"success"==s&&(e=this.options.attributeSuccessMessage),t.hasAttribute(e))},this.getScriptMsg=function(t,s){var e=this.getScriptItem(t);return this.hasScriptMsg(t,"error")&&"error"==s?e.errorMsg:this.hasScriptMsg(t,"prompt")&&"prompt"==s?e.promptMsg:this.hasScriptMsg(t,"success")&&"success"==s?e.successMsg:void 0},this.hasScriptMsg=function(t,s){var e=t.getAttribute("name");if(e){if(e=this.getScriptItem(e),"error"==s)return void 0!==e.errorMsg;if("prompt"==s)return void 0!==e.promptMsg;if("success"==s)return void 0!==e.successMsg}},this.hasTpl=function(t){var s=t.getAttribute("name");if(s)return void 0!==(s=this.getScriptItem(s)).tpl},this.getTpl=function(t){if(this.hasTpl(t)){var s=t.getAttribute("name");return(s=this.getScriptItem(s)).tpl}return!!t.hasAttribute("data-tpl")&&t.getAttribute("data-tpl")},this.getTplMsg=function(t){var s=t.getAttribute("name"),e=this.getScriptItem(s);if(t.hasAttribute("data-tpl-msg"))return t.getAttribute("data-tpl-msg");if(void 0!==e.tplMsg)return e.tplMsg;return this.tpls_msg()[this.getTpl(t)]},this.getScriptItem=function(t){"string"!=typeof t&&(t=t.getAttribute("name"));for(var s=0;s<this.options.items.length;s++)if(this.options.items[s].item==t)return this.options.items[s];return!1},this.getSubmitElement=function(){return"#"==this.options.eventElement[0]?document.getElementById(this.options.eventElement.slice(1)):document.getElementsByClassName(this.options.eventElement.slice(1))},this.getElement=function(t){return"#"==t[0]?document.getElementById(t.slice(1)):document.getElementsByClassName(t.slice(1))},this.getValInput=function(){return document.getElementsByClassName(this.options.classItem)},this.getInputByName=function(t){return document.getElementsByName(t)},this.clearInput=function(t){var s=this.getInputByName(t);if(s.length>0)for(var e=0;e<s.length;e++)this.deleteErrorMsg(s[e]),s[e].value=""},this.insertAfter=function(t,s){var e=s.parentNode,r=s.nextSibling;return r?e.insertBefore(t,r):e.appendChild(t)},this.findFalse=function(t){for(var s=0;s<t.length;s++)if(!1===t[s])return!1;return!0},this.ajaxValidPost=function(t,s){if(s=s||function(){},this.options.ajax){var e=new XMLHttpRequest,r=this,i=!1;if(t.length>1){for(var a="",o=0;o<t.length;o++)a+=t[o].getAttribute("name")+"="+encodeURIComponent(t[o].value)+"&";e.open("POST",this.options.ajaxUrl,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status){try{var s=JSON.parse(e.responseText)}catch(t){s=!1}if(s)for(var a=0;a<s.length;a++){var o=document.getElementsByName(s[a].item);0==s[a].status?(r.deleteErrorMsg(o[0]),r.generateMsg(o[0],"error",s[a].error_msg),i=!0):(r.deleteErrorMsg(o[0]),r.generateMsg(o[0],"success"))}}else for(var n=0;n<t.length;n++)r.deleteErrorMsg(t[n]),r.generateMsg(t[n],"error","Ошибка "+e.status),i=!0},a=a.slice(0,a.length-1),e.send(a)}else t.hasAttribute("data-url")&&(e.open("POST",this.options.ajaxUrl,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status){try{var s=JSON.parse(e.responseText)}catch(t){s=!1}s&&(0==s.status?(r.deleteErrorMsg(t),r.generateMsg(t,"error",s.error_msg),i=!0):(r.generateMsg(t,"success"),r.deleteErrorMsg(t)))}else r.deleteErrorMsg(t),r.generateMsg(t,"error","Ошибка "+e.status),i=!0},e.send(t.getAttribute("name")+"="+encodeURIComponent(t.value)));var n=this.getParent(this.getSubmitElement(),"FORM");e.onloadend=function(){s(e.responseText,i,n)}}},this.deleteErrorMsg=function(t){var s=this.getScriptItem(t);if(void 0!==s.errorClass&&t.classList.remove(s.errorClass),void 0!==s.successClass&&t.classList.remove(s.successClass),t.classList.remove(this.options.errorClass),t.classList.remove(this.options.successClass),null!=t.nextElementSibling&&(t.nextElementSibling.classList.contains(this.getMsgErrorClass(t))?t.nextElementSibling.remove():t.nextElementSibling.classList.contains(this.getMsgPromptClass(t))?t.nextElementSibling.remove():t.nextElementSibling.classList.contains(this.getMsgSuccessClass(t))&&t.nextElementSibling.remove(),t.hasAttribute("data-box"))){var e=document.getElementsByClassName("error-to-"+t.getAttribute("name"));e.length>0&&e[0].remove()}},this.tpl=[],this.tpls=function(){for(var t=0;t<this.options.tpl.length;t++)""!==this.options.tpl[t].name&&""!==this.options.tpl[t].tpl&&(this.tpl[this.options.tpl[t].name]=this.options.tpl[t].tpl);return this.tpl.number=/^\d+$/,this.tpl.lat=/^[a-zA-Z]+$/,this.tpl.kir=/^[А-Яа-яЁё\s]+$/,this.tpl["kir+lat"]=/^[a-zA-ZА-Яа-яЁё\s]+$/,this.tpl["kir+number"]=/^[\dА-Яа-яЁё\s]+$/,this.tpl["lat+number"]=/^[\da-zA-Z]+$/,this.tpl.email=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/,this.tpl},this.tpl_msg=[],this.tpls_msg=function(){for(var t=0;t<this.options.tpl_msg.length;t++)""!==this.options.tpl_msg[t].name&&""!==this.options.tpl_msg[t].msg&&(this.tpl_msg[this.options.tpl_msg[t].name]=this.options.tpl_msg[t].msg);return this.tpl_msg.number="Толь цифры",this.tpl_msg.lat="Только латиница",this.tpl_msg.kir="Только кириллица",this.tpl_msg["kir+lat"]="Только кириллица и латиница",this.tpl_msg["kir+number"]="Только кириллица и цифры",this.tpl_msg["lat+number"]="Только латиница и цифры",this.tpl_msg.email="Не корректный email",this.tpl_msg},this.addTpl=function(t,s,e){this.tpl[t]=s,this.tpl_msg[t]=e}}